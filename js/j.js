var app=angular.module("KwickApp",["ngStorage"]);app.controller("kwickCtrl",["$http","$localStorage",function(e,t){this.signUp=function(n,a){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/signup/"+n+"/"+a+"?callback=JSON_CALLBACK"}).success(function(e){"done"==e.result.status&&(t.kwickToken=e.result.token,t.kwickId=e.result.id,window.location="/tchat.html")}).error(function(e){})},this.signIn=function(n,a){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/login/"+n+"/"+a+"?callback=JSON_CALLBACK"}).success(function(e){"done"==e.result.status&&(t.kwickToken=e.result.token,t.kwickId=e.result.id,window.location="/tchat.html")}).error(function(e){})},this.logOut=function(){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/logout/"+t.kwickToken+"/"+t.kwickId+"?callback=JSON_CALLBACK"}).success(function(e){"done"==e.result.status&&(t.$reset(),window.location="index.html")}).error(function(e){console.log("erreur vous n'etes pas déconnecté !")})}}]),app.controller("kwickTchatCtrl",["$http","$localStorage",function(e,t){this.UsersConnected=function(){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/user/logged/"+t.kwickToken+"?callback=JSON_CALLBACK"}).success(function(e){for(var t=e.result.user,n=[],a=0;a<t.length;a++)n.push("<li><a>"+t[a]+"</a></li>");$(".sidebar-nav").append(n)}).error(function(e){})},this.UsersConnected()}]),app.controller("kwickSendMessagesCtrl",["$http","$localStorage",function(e,t){this.sayMessages=function(n){var a=encodeURI(n);e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/say/"+t.kwickToken+"/"+t.kwickId+"/"+a+"?callback=JSON_CALLBACK"}).success(function(e){}).error(function(e){})}}]),app.controller("kwickListMessagesCtrl",["$http","$localStorage","$interval",function(e,t,n){function a(e){var t=new Date(1e3*e),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=t.getFullYear(),s=n[t.getMonth()],l=t.getDate(),o=t.getHours(),c=t.getMinutes(),i=t.getSeconds(),r=l+" "+s+" "+a+" "+o+":"+c+":"+i;return r}var s=this,l=(new Date).getTime();this.listMessages=function(){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/talk/list/"+t.kwickToken+"/0?callback=JSON_CALLBACK"}).success(function(e){for(var t=e.result.talk,n=0;n<t.length;n++)$(".all-messages").append('<h2><span class="glyphicon glyphicon-user" aria-hidden="true" style="padding-right: 10px;"></span>'+t[n].user_name+"</h2> dit : <p>"+t[n].content+"</p> le : "+a(t[n].timestamp));$(".all-messages").animate({scrollTop:$(".all-messages p:last-of-type").offset().top},600)}).error(function(e){})},this.listMessages(),this.refreshMessages=function(){e({method:"JSONP",url:"http://greenvelvet.alwaysdata.net/kwick/api/talk/list/"+t.kwickToken+"/"+l+"?callback=JSON_CALLBACK"}).success(function(e){for(var t=e.result.talk,n=0;n<t.length;n++)$(".all-messages").append('<h2><span class="glyphicon glyphicon-user" aria-hidden="true" style="padding-right: 10px;"></span>'+t[n].user_name+"</h2> dit : <p>"+t[n].content+"</p> le : "+a(t[n].timestamp))}).error(function(e){})},setInterval(function(){console.log(l),s.refreshMessages(l)},5e3)}]);